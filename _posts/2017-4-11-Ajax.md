---
layout: post
title: Ajax
tags:
- java

categories: java
description: Ajax
---
## 什么是Ajax
> Asynchonous JavaScript And Xml
> 是一种用于创建更好更快以及交互性更强的web应用程序
* Axja:只刷新布局页面技术
```html
步骤
 |
 |--创建对象 var xmlHttp
 |		|
 |		|-- if(window.XMLHttpRequest){
 |				//IE7+ Firefox Chrome Opera Safari
 |				xmlHttp=new XMLHttpRequest();
 |		    }else{
 |		    	//IE6 IE5
 |		    	xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
 |		    }		
 |
 |--事件处理onreadystatechange
 |	  |
 |	  |-- xmlHttp.onreadstatechange=function(){
 |			 if(xmlHttp.readyState==4&&xmlHttp.status==200){
 |					alert(xmlHttp.responseText);
 |				}
 |		  }
 |
 |--创建连接open("get|post","url?name=tom","true|false")
 |			|
 |			|--请求方式  请求地址 是否异步
 |
 |
 |--发送请求send(content) content参数指定请求的参数或null
 |
 |
 |--设置消息头setRequestHeader(header,value)
 |
 |
 |--属性
 |	 |
 |	 |--readyState:类型short 只读
 |	 |		|
 |	 |		|--0:刚初始化
 |	 |		|--1:调用open还没调用send
 |	 |		|--2:send调用还没收到响应
 |	 |		|--3:收到响应头还没收到响应正文
 |	 |		|--4:一切都收到了
 |	 |			
 |   |--responseText:类型String 只读
 |	 |--responseXML: 类型Document 只读
 |	 |--status:服务器响应状态码 类型short 只读
 |			|
 |			|--200 服务器响应正常
 |			|--400 无法找到请求的资源
 |			|--403 没有访问权限
 |			|--404 访问的资源不存在
 |			|--500 服务器内部错误
 |
 |
```
###### 初体验
```javascript
//myJs.js
function getXMLHttpRequest(){
    var xmlHttp;
    if(window.XMLHttpRequest){
        xmlHttp=new XMLHttpRequest();
    }else {
        xmlHttp=new ActiveXObject();
    }
    return xmlHttp;
}

//1.jsp
<script type="text/javascript" src="js/myJs.js"></script>
<script type="text/javascript">
    window.onload=function(){
        var req=getXMLHttpRequest();
        req.onreadystatechange=function(){
            if(req.readyState==4&&req.status==200){
                alert(req.responseText);
            }
        }
        req.open("get","${pageContext.request.contextPath}/servlet/servletDemo1",true);
        req.send(null);
    }
</script>

//servletDemo1
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setContentType("text/html;charset=utf-8");
    PrintWriter out = resp.getWriter();
    out.println("你好 ajax Asynchonous JavaScript And Xml ");
}
```

###### 验证用户名
```javascript
//reg.jsp
<script type="text/javascript" src="js/myJs.js"></script>
<script type="text/javascript">
    function ckName() {
        var name=document.getElementsByName("username")[0].value;
        var xhr=getXMLHttpRequest();
        xhr.onreadystatechange=function(){
            if(xhr.readyState==4&&xhr.status==200){
                var msg=document.getElementById("msg");
                if(xhr.responseText=="true"){
                    msg.style.color="red";
                    msg.innerHTML="用户名已存在"
                }else {
                    msg.style.color="green";
                    msg.innerHTML="用户名可以使用"
                }
            }
        }
        xhr.open("get","${pageContext.request.contextPath}/servlet/ckNameServlet?name="+name);
        xhr.send(null);
    }
</script>

//ckNameServlet
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setContentType("text/html;charset=utf-8");
    PrintWriter out = resp.getWriter();
    req.setCharacterEncoding("utf-8");
    String name = req.getParameter("name");
    if("tom".equals(name)){
        out.print(true);
    }else {
        out.print(false);
    }
}
```
## Json对象
```html
Json对象使用步骤
	|
	|--添加jar
	| 	 |
	|	 |--commons-beanutils-1.8.3.jar
	|	 |--commons-collections-3.2.1.jar
	|	 |--commons-lang-2.6.jar
	|	 |--commons-logging-1.1.1.jar
	|	 |--ezmorph-1.0.6.jar
	|	 |--json-lib-2.4-jdk15.jar
	|
	|--将Object转换成json字符串
	|		|
	|		|--String jsonObjct = JSONObject.fromObject(obj).toString();
	|
	|--将list转换成json字符串
	|		|
	|		|--String s = JSONArray.fromObject(list).toString();
	|
	|--字段过滤
		 |
		 |-- JsonConfig js=new JsonConfig();//排除
             js.setExcludes(new String[]{"pnum","description","category","id","author"});
             String s=JSONArray.fromObject(list,js).toString();
```
```javascript
public class JsonTest {
    @Test
    public void test1(){
        Book b=new Book();
        b.setId("1001");
        b.setName("盗墓笔记");
        b.setPrice("98.00");
        String s = JSONObject.fromObject(b).toString();
        System.out.println(s);
    }
    @Test
    public void test2(){
        ArrayList<Book> list = new ArrayList<>();
        list.add(new Book("1001","盗墓笔记","98.00","南派三叔"));
        list.add(new Book("1002","鬼吹灯","89.00","天下霸唱"));
        list.add(new Book("1003","诛仙","67.00",""));
        String s = JSONArray.fromObject(list).toString();
        System.out.println(s);
    }
    @Test
    public void test3() throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource());
        List<Book> list = qr.query("select * from book", new BeanListHandler<Book>(Book.class));
        JsonConfig js=new JsonConfig();//排除
        js.setExcludes(new String[]{"pnum","description","category","id","author"});
        String s=JSONArray.fromObject(list,js).toString();
        System.out.println(s);
    }
}
```
