---
layout: post
title: mysql
tags:
- java

categories: java
description: mysql
---
## 数据库
> 存储，维护，管理数据的集合
## mac卸载mysql
>打开终端，全部拷贝下面的内容，回车
```html
cd ~/
sudo rm /usr/local/mysql
sudo rm -rf /usr/local/var/mysql
sudo rm -rf /usr/local/mysql*
sudo rm -rf /Library/StartupItems/MySQLCOM
sudo rm -rf /Library/PreferencePanes/My*
vim /etc/hostconfig and removed the line MYSQLCOM=-YES-rm -rf ~/Library/PreferencePanes/My*
sudo rm -rf /Library/Receipts/mysql*
sudo rm -rf /Library/Receipts/MySQL*
sudo rm -rf /var/db/receipts/com.mysql.*
```

## mac mysql安装

* https://dev.mysql.com/downloads/file/?id=467574 下载 mysql-5.7.17-macos10.12-x86_64.dmg
* 安装mysql 保存生成的密码root@localhost: iHC9eJ:(Bm.g
* 进入系统偏好设置, 找到mysql, 启动服务
* 检查 进入/usr/local/mysql/bin,查看此目录下是否有mysql
*  配置命令 执行vim ~/.bash_profile 在文件中添加PATH=$PATH:/usr/local/mysql/bin
添加完成后，按esc，然后输入wq保存。
* 最后在命令行输入source ~/.bash_profile 使配置文件生效
* 通过mysql -u root -p 登陆mysql, 输入之前保存的密码

## mac修改mysql密码

* 打开终端输入 sudo /usr/local/mysql/bin/mysqld_safe --skip-grant-tables
* 重新打开一个终端输入
sudo /usr/local/mysql/bin/mysql -u root
UPDATE mysql.user SET authentication_string=PASSWORD('新密码') WHERE User='root';
FLUSH PRIVILEGES;



## 登陆mysql
> mysql -h 127.0.0.1 -u root -p
## 启动mysql
> sudo /usr/local/MySQL/support-files/mysql.server start
## 停止mysql
> sudo /usr/local/mysql/support-files/mysql.server stop
## 重启mysql
> sudo /usr/local/mysql/support-files/mysql.server restart
## mac修改mysql默认编码方式


* 进入系统偏好设置-->MySql-->停用mysql的服务
* 在终端中执行 sudo -s
* 输入电脑管理员的密码
* cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf
* vi /etc/my.cnf
   在打开的my.cnf文件中增加如下配置,如何操作呢?点击键盘的 i 字母,即可进入编辑模式
   [client]
   default-character-set = utf8
   [mysqld]
   default-storage-engine = INNODB
   character-set-server = utf8
   collation-server = utf8_general_ci
* 按esc键
* 输入 :wq
* 进入系统偏好设置-->MySql-->重启mysql的服务

## DDL操作数据库 表 列 行
|方法|备注|
|-----|------|
|create database db_name|创建数据库|
|create database db_name character set gbk|创建数据库并设置编码方式|
|create database db_name character set utf8 collate utf8_general_ci|添加校验规则|
|show databases|查询所有数据库|
|show create database db_name|查询数据库定义信息|
|show character set|查询数据库支持的编码|
|Drop database db_name|删除数据库|
|alter database db_name charaset set utf8|修改数据库|
|select database()|查询当前数据库|
|use db_name|使用数据库|

## 操作数据表
###### 创建表
>create table 表名{
字段1，字段类型,
字段2，字段类型,
......
字段n,字段类型
}

* 常用数据类型

|类型|备注|
|-----|-----|
| int| 整型|
| double |浮点型double(5,2)最多5位 小数2位||
| char|固定长度字符串char(10),最多10个，不足10个用空格补全|
| varchar|可变长度字符串varchar(10)|
| text|字符串类型,大数据文本 4MB|
| blob |字节类型，图片，音频|
| date|日期类型 yyyy-MM-dd|
| time|日期时间 hh:mm:ss|
|timestamp|时间戳类型 yyyy-MM-dd hh:mm:ss 会自动赋值|
|datetime|日期时间类型 yyyy-MM-dd hh:mm:ss|
## 常用操作
|方法|备注|
|-----|-----|
|show tables| 查看数据库所有表|
|DESC 表名|查看表的字段信息|
|alter table 表名 add 字段 字段类型|添加字段|
|alter table 表名 modify 字段 字段类型|修改字段长度类型|
|alter table 表名 drop 字段|删除字段|
|rename table 表名 to 新表名|修改表名|
|show create table 表名|查看表的创建源码|
|alter table 表名 character set gbk|修改表的编码方式|
|alter table 表名 change 字段 新字段 新字段类型|修改字段名|
|drop table 表名|删除表|

## DML数据操作

|方法|备注|
|-----|-----|
|select * from 表名|查询表中数据|
|insert into 表名(字段1，字段2..字段n)values(值1，值2...值n)|向表中插入数据)|
|insert into 表名 values(值1，值2，...值n|全部给值|
|insert into 表名 values(值..),(值...),(值...)|批量插入|
|update 表名 set 列名=值，列名=值 where 条件|修改值|
|update 表名 set 列名=列名+1000|除了支持赋值还支持运算|
|delete from 表名 where...|删除|
|delete from 表名|删除表中所有数据|
|truncate table 表名|删除表，数据不能找回
|select 字段1，字段2...字段n from 表名|查询指定字段|

## where
|语法|备注|
|-----|-----|
|=,!=,<>,<,<=,>,>=||
|between min and max | [min,max]|
|in(set)||
|is null|空|
|is not null|非空|
|and|&|
|or|'|'|
|not|非|

## 模糊查询 like
>_任意一个字符
%任意0-n个字符
## 条件限制
|语法|备注|
|-----|-----|
|select distinct 字段 from 表名| 去除重复字段|
|select distinct 字段1，字段2| 去除字段1和字段2都相同的|
|select 字段1+字段2 from 表名|返回字段1和字段2的和|
|select ifnull(字段1,默认值)+字段2 from 表名|ifnull滤空函数|
|select ifnull(字段1,默认值)+字段2 as 别名 from 表名|as取别名|
|select 字段1 as 别名1，字段2 别名2 from 表名|as可以省略|
## 排序
|语法|备注|
|-----|-----|
|select * from 表名 order by 字段名 asc|升序|
|select * from 表名 order by 字段名 desc|降序|
|select * from 表名 order by 字段1，字段2|按字段1升序，如果1相等按2升序|
## 聚合函数
>聚合函数是用来做纵向运算的函数,聚合函数自动滤空

|函数|备注|
|-----|-----|
|count()|统计指定列不为null的记录函数|
|max()|计算指定列的最大值|
|min()|计算指定列的最小值|
|sum()|计算指定列的最小值|
|avg()|计算指定列的平均值|

## 分组查询 group by
>凡和聚合函数同时出现的列名,则一定要写在group by之后
having 对分组后的数据进行过滤
where  是在分组前对数据进行过滤
having 后面可以用聚合函数
where 后面不能使用聚合函数
查询语句书写顺序
select-from-where-group by-having-order by-limit
查询语句执行顺序
from-where-group by-having-select-order by-limit

## limit
>limit 用来限定执行结果数 limit start,sum.从第几行开始查几行

```sql
select distinct(deptno),count(deptno),sum(sal),avg(sal),sum(ifnull(comm,0)),avg(ifnull(comm,0)) from emp where mgr is not null and sal like'%0%' or deptno not in(10,20,30) or deptno between 0 and 30 group by deptno having sum(sal)>1000 order by deptno,sum(sal) limit 0,3;
```
