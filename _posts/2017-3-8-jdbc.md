---
layout: post
title: jdbc
tags:
- java

categories: java
description: jdbc
---
## jdbc
> java database connectivity
> sun公司提供的一套操作数据库的标准规范
## jdbc 规范
* DriverManager 用于注册驱动
* Connection 表示与数据库创建的链接
* Statement 操作数据库sql语句的对象
* ResultSet 结果集或者虚拟表
```java
//注册驱动
DriverManager.registerDriver(new com.mysql.jdbc.Driver());
//获取链接Connection
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/day06", "root", "root");
//得到执行语句对象statement
Statement stmt = conn.createStatement();
//执行sql语句，并返回结果
ResultSet rs = stmt.executeQuery("select * from users");
//处理结果
while(rs.next()){
    System.out.println(rs.getObject(1));
    System.out.println(rs.getObject(2));
    System.out.println(rs.getObject(3));
    System.out.println(rs.getObject(4));
    System.out.println(rs.getObject(5));
    System.out.println("-------------");
}
//关闭资源
rs.close();
stmt.close();
conn.close();
```
## java.sql.DriverManager
```
注册驱动
DriverManage.registDriver(Driver driver) 不建议使用(1.导致驱动被注册2次,2.强烈依赖jar包)
加载驱动 Class.froNmae("com.mysql.jdbc.Driver"); Driver里面有静态代码块注册驱动
jdbc:mysql://localhost:3306/day06
协议:子协议://ip:端口/数据库
oracle:jdbc:oracle:thin:@localhost:1521:sid
//第二种方式
Properties info=new Properties();
info.setProperty("user","root");
info.setProperty("password","root");
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/day06", info);
//第三种方式
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/day06?user=root&password=root");
```
## java.sql.Connection
```
1.接口的实现在数据库驱动中，所有与数据库交互都是基于链接对象
2.Statement createStatement();
```
## java.sql.Statement
```
1. 接口的实现在数据库驱动中。用于执行静态sql语句并返回它所生成结果的对象
2. ResultSet executeQuery(String sql) 根据查询语句返回结果集，只能执行查询。
3. int executeUpdate(String sql) 执行insert,delete,update语句返回受影响的行数
4. boolean execute(String sql) 执行任意sql,仅当执行select语句且有结果返回true ，
    ResultSet getResultSet()。
```
## java.sql.ResultSet
```
封装结果集
提供一个游标，默认游标在第一行之前
调用next()方法，游标向下移动一行
Object getObject(int index)
Object getObject(String name)
java的数据类型与数据库类型关系
int-int folat-float double -double String-char varchar Date-date
可移动游标的方法
boolean next()
boolean previous()
boolean afterLast()将游标移动到末尾，最后一行之后
boolean beforeFirst() 移动到开头，第一行之前
```
```
Class.forName("com.mysql.jdbc.Driver");
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/day06", "root", "root");
Statement stmt=conn.createStatement();
ResultSet rs=stmt.executeQuery("select * from users");
ArrayList<User> users = new ArrayList<>();
while(rs.next()){
    User user = new User();
    user.setId(rs.getInt("id"));
    user.setName(rs.getString("name"));
    user.setPassword(rs.getString("password"));
    user.setBirthday(rs.getDate("birthday"));
    user.setEmail(rs.getString("email"));
    users.add(user);
}
System.out.println(users);
rs.close();
stmt.close();
conn.close();
```
## 释放资源
```
Connection conn=null;
Statement stmt=null;
ResultSet rs=null;
try {
    Class.forName("com.mysql.jdbc.Driver");
    conn=DriverManager.getConnection("jdbc:mysql://localhost:3306/day06","root","root");
    stmt=conn.createStatement();
    rs=stmt.executeQuery("select * from users");
} catch (Exception e) {
    e.printStackTrace();
}finally {
    if(conn!=null){
        try {
            conn.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    if(stmt!=null){
        try {
            stmt.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    if(rs!=null){
        try {
            rs.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```
## CRUD
```
public class DBUtils {
    private static String driverClass;
    private static String url;
    private static String username;
    private static String password;
    static {
        ResourceBundle rb= ResourceBundle.getBundle("dbinfo");
        driverClass=rb.getString("driverClass");
        url=rb.getString("url");
        username=rb.getString("username");
        password=rb.getString("password");
        try {
            Class.forName(driverClass);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
    //得到链接的方法
    public static Connection getConnection()throws Exception{

        return DriverManager.getConnection(url,username,password);
    }
    //关闭资源
    public static void closeAll(ResultSet rs, Statement stmt,Connection conn){
        if(rs!=null){
            try {
                rs.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        if(stmt!=null){
            try {
                stmt.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        if(conn!=null){
            try {
                conn.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}
```

## sql注入
> ' or '1'='1

## preparedStatement
> 性能高
> 会把SQL语句先编译
> 过滤用户输入 的关键字
```
conn=DBUtils.getConnection();
String sql="select * from users where name=? and password=?";
stmt=conn.prepareStatement(sql);
stmt.setString(1,name);
stmt.setString(2,password);
rs=stmt.executeQuery();
```
