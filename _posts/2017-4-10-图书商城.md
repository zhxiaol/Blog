---
layout: post
title: 图书商城
tags:
- java

categories: java
description:图书商城
---
###### admin/product/list.jsp
```
<%@ page language="java" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<HTML>
<HEAD>
   <meta http-equiv="Content-Language" content="zh-cn">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <link href="${pageContext.request.contextPath}/admin/css/Style.css"
        rel="stylesheet" type="text/css" />
   <script language="javascript"
         src="${pageContext.request.contextPath}/admin/js/public.js"></script>
   <script type="text/javascript">
        function addProduct() {
            window.location.href = "${pageContext.request.contextPath}/admin/products/add.jsp";
        }
        function delAllBooks(){
            <%--var ids=document.getElementsByName("ids");--%>
            <%--var str="";--%>
            <%--for(var i=0;i<ids.length;i++){--%>
                <%--if(ids[i].checked){--%>
                    <%--str+="ids="+ids[i].value;--%>
                    <%--if(i!=ids.length)--%>
                        <%--str+="&";--%>
                <%--}--%>
            <%--}--%>
            <%--if(str!=""){--%>
                <%--location.href="${pageContext.request.contextPath}/servlet/delAllBooksServlet?"+str;--%>
            <%--}--%>
         var form2=document.getElementById("form2");
         form2.submit();
        }
        function delBook(id){
            if(confirm("是否确定删除")){
                location.href="${pageContext.request.contextPath}/servlet/delBookServlet?id="+id;
            }
        }
        function checkAll(){
            var flag=document.getElementById("ckAll").checked;
            var ids=document.getElementsByName("ids");
            for(var i=0;i<ids.length;i++){
                ids[i].checked=flag;
            }
        }
   </script>
</HEAD>
<body>
<br>
<table cellSpacing="1" cellPadding="0" width="100%" align="center"
      bgColor="#f5fafe" border="0">
   <form id="Form1" name="Form1"
        action="${pageContext.request.contextPath}/servlet/searchBooksServlet"
        method="post">
      <TBODY>
      <tr>
         <td class="ta_01" align="center" bgColor="#afd1f3"><strong>查
            询 条 件</strong>
         </td>
      </tr>
      <tr>
         <td>
            <table cellpadding="0" cellspacing="0" border="0" width="100%">
               <tr>
                  <td height="22" align="center" bgColor="#f5fafe" class="ta_01">
                     商品编号</td>
                  <td class="ta_01" bgColor="#ffffff"><input type="text"
                                                   name="id" size="15" value="" id="Form1_userName" class="bg" />
                  </td>
                  <td height="22" align="center" bgColor="#f5fafe" class="ta_01">
                     类别：</td>
                  <td class="ta_01" bgColor="#ffffff"><select name="category"
                                                   id="category">
                     <option value="" selected="selected">--选择商品类加--</option>
                     <option value="文学">文学</option>
                     <option value="生活">生活</option>
                     <option value="计算机">计算机</option>
                     <option value="外语">外语</option>
                     <option value="经营">经营</option>
                     <option value="励志">励志</option>
                     <option value="社科">社科</option>
                     <option value="学术">学术</option>
                     <option value="少儿">少儿</option>
                     <option value="艺术">艺术</option>
                     <option value="原版">原版</option>
                     <option value="科技">科技</option>
                     <option value="考试">考试</option>
                     <option value="生活百科">生活百科</option>
                  </select></td>
               </tr>

               <tr>
                  <td height="22" align="center" bgColor="#f5fafe" class="ta_01">
                     商品名称：</td>
                  <td class="ta_01" bgColor="#ffffff"><input type="text"
                                                   name="name" size="15" value="" id="Form1_userName" class="bg" />
                  </td>
                  <td height="22" align="center" bgColor="#f5fafe" class="ta_01">
                     价格区间(元)：</td>
                  <td class="ta_01" bgColor="#ffffff"><input type="text"
                                                   name="minprice" size="10" value="" />- <input type="text"
                                                                                     name="maxprice" size="10" value="" /></td>
               </tr>

               <tr>
                  <td width="100" height="22" align="center" bgColor="#f5fafe"
                     class="ta_01"></td>
                  <td class="ta_01" bgColor="#ffffff"><font face="宋体"
                                                  color="red"> &nbsp;</font>
                  </td>
                  <td align="right" bgColor="#ffffff" class="ta_01"><br>
                     <br></td>
                  <td align="right" bgColor="#ffffff" class="ta_01">
                     <button type="submit" id="search" name="search"
                           value="&#26597;&#35810;" class="button_view">
                        &#26597;&#35810;</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input
                        type="reset" name="reset" value="&#37325;&#32622;"
                        class="button_view" />
                  </td>
               </tr>
            </table>
   </form>
   </td>

   </tr>
   <tr>
      <td class="ta_01" align="center" bgColor="#afd1f3"><strong>商品列表</strong>
      </TD>
   </tr>
   <form id="form2" action="${pageContext.request.contextPath}/servlet/delAllBooksServlet" method="post">
   <tr>
      <td class="ta_01" align="right">
         <button type="button" id="delAll" name="delAll" value="批量删除"
               class="button_add" onclick="delAllBooks()">批量删除
         </button>
         <button type="button" id="add" name="add" value="添加"
               class="button_add" onclick="addProduct()">添加
         </button>
      </td>
   </tr>
   <tr>
      <td class="ta_01" align="center" bgColor="#f5fafe">
         <table cellspacing="0" cellpadding="1" rules="all"
               bordercolor="gray" border="1" id="DataGrid1"
               style="BORDER-RIGHT: gray 1px solid; BORDER-TOP: gray 1px solid; BORDER-LEFT: gray 1px solid; WIDTH: 100%; WORD-BREAK: break-all; BORDER-BOTTOM: gray 1px solid; BORDER-COLLAPSE: collapse; BACKGROUND-COLOR: #f5fafe; WORD-WRAP: break-word">
            <tr
                  style="FONT-WEIGHT: bold; FONT-SIZE: 12pt; HEIGHT: 25px; BACKGROUND-COLOR: #afd1f3">
               <td align="center" width="9%"><input type="checkbox" id="ckAll" onclick="checkAll()" >全选/全不选</td>
               <td align="center" width="24%">商品编号</td>
               <td align="center" width="18%">商品名称</td>
               <td align="center" width="9%">商品价格</td>
               <td align="center" width="9%">商品数量</td>
               <td width="8%" align="center">商品类别</td>
               <td width="8%" align="center">编辑</td>

               <td width="8%" align="center">删除</td>
            </tr>
            <c:forEach items="${books}" var="b">
               <tr onmouseover="this.style.backgroundColor = 'white'"
                  onmouseout="this.style.backgroundColor = '#F5FAFE';">
                  <td align="center" width="9%"><input type="checkbox" name="ids" value="${b.id}" ></td>
                  <td align="center" width="24%">${b.id}</td>
                  <td align="center" width="18%">${b.name}</td>
                  <td align="center" width="9%">${b.price}</td>
                  <td align="center" width="9%">${b.pnum}</td>
                  <td width="8%" align="center">${b.category}</td>
                  <td align="center" style="HEIGHT: 22px" width="7%"><a
                        href="${pageContext.request.contextPath}/servlet/findBookByIdServlet?id=${b.id }">
                     <img
                           src="${pageContext.request.contextPath}/admin/images/i_edit.gif"
                           border="0" style="CURSOR: hand"> </a>
                  </td>

                  <td align="center" style="HEIGHT: 22px" width="7%"><a
                        href="#">
                     <a href="javascript:delBook('${b.id}')">
                        <img
                              src="${pageContext.request.contextPath}/admin/images/i_del.gif"
                              width="16" height="16" border="0" style="CURSOR: hand">
                     </a>
                  </a>
                  </td>
               </tr>
            </c:forEach>

         </table>

      </td>
   </tr>
   </TBODY>
   </form>
</table>
</body>
</HTML>
```
###### C3P0Util
```
public class C3P0Util {
    private static DataSource ds=new ComboPooledDataSource();
    public static Connection getConnection(){
        try {
            return ds.getConnection();
        } catch (SQLException e) {
            e.printStackTrace();
            throw new RuntimeException("获得数据连接失败");
        }
    }
    public static DataSource getDataSource(){
        return ds;
    }
    public static DataSource getDataSource(String databaseName){
        ComboPooledDataSource testDs= (ComboPooledDataSource) ds;
        testDs.setJdbcUrl("jdbc:mysql://localhost:3306/"+databaseName+"?characterEncoding=utf-8");
        return testDs;
    }
    public static void release(ResultSet rs, Statement stmt, Connection conn){
        try {
            if(rs!=null)
                rs.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }finally {
            try {
                if(stmt!=null)
                    stmt.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }finally {
                try {
                    if(conn!=null)
                        conn.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
        }
    }

    public static Connection getConnection(String databaseName) {
        ComboPooledDataSource testDs= (ComboPooledDataSource) ds;
        testDs.setJdbcUrl("jdbc:mysql://localhost:3306/"+databaseName+"?characterEncoding=utf-8");
        try {
            return testDs.getConnection();
        } catch (SQLException e) {
            e.printStackTrace();
            throw new RuntimeException("初始化数据库连接失败");
        }
    }
}
```
###### BookServiceImpl
```
public class BookServiceImpl {
    private BookDaoImpl dao=new BookDaoImpl();
    public List<Book> findAllBooks(){
        try {
            return dao.findAllBooks();
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return null;
    }
    public void addBook(Book book){
        try {
            dao.addBook(book);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public Book findBookById(String id) {
        try {
            return dao.findBookById(id);
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return null;
    }

    public void updateBook(Book book) {
        try {
            dao.updateBook(book);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public void delBookById(String id) {
        try {
            dao.delBookById(id);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public void delAllBooks(String[] ids) {
        try {
            dao.delAllBooks(ids);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public List<Book> searchBooks(String id, String category, String name, String minprice, String maxprice) {
        try {
            return dao.searchBooks(id,category,name,minprice,maxprice);
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return null;
    }

    public PageBean findBooksPage(int currentPage, int pageSize) {
        PageBean pb = new PageBean();
        try {
            int count=dao.count();
            int totalPage= (int) Math.ceil(count*1.0/pageSize);
            List<Book>list=dao.findBooksByPage(currentPage,pageSize);
            pb.setCount(count);
            pb.setCurrentPage(currentPage);
            pb.setBooks(list);
            pb.setTotalPage(totalPage);
            return pb;
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return null;
    }
}
```
###### BookDaoImpl
```
public class BookDaoImpl {
    //查找所有的图书
    public List<Book> findAllBooks() throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        return qr.query("select * from book",new BeanListHandler<Book>(Book.class));
    }
    //添加图书
    public void addBook(Book book) throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        qr.update("insert into book values(?,?,?,?,?,?)",book.getId(),book.getName(),book.getPrice(),book.getPnum(),book.getCategory(),book.getDescription());
    }

    public Book findBookById(String id) throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        return qr.query("select * from book where id = ?",new BeanHandler<Book>(Book.class),id);
    }

    public void updateBook(Book book) throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        qr.update("update book set name =?,price =?,pnum=?,category=?,description=? where id =?",book.getName(),book.getPrice(),book.getPnum(),book.getCategory(),book.getDescription(),book.getId());
    }

    public void delBookById(String id) throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        qr.update("delete from book where id =?",id);
    }

    public void delAllBooks(String[] ids)throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        Object[][] params = new Object[ids.length][];
        for(int i=0;i<params.length;i++){
            params[i]=new Object[]{ids[i]};
        }
        qr.batch("delete from book where id = ?",params);

    }

    public List<Book> searchBooks(String id, String category, String name, String minprice, String maxprice) throws SQLException {
        String sql="select * from book where 1=1";
        ArrayList<String> params = new ArrayList<>();
        if(!"".equals(id.trim())){
            sql+=" and id like ?";
            params.add("%"+id+"%");
        }
        if(!"".equals(category.trim())){
            sql+=" and category = ?";
            params.add(category);
        }
        if(!"".equals(name.trim())){
            sql+=" and name like ?";
            params.add("%"+name+"%");
        }
        if(!"".equals(minprice.trim())){
            sql+= " and price >= ?";
            params.add(minprice);
        }
        if(!"".equals(maxprice.trim())){
            sql+=" and price <= ?";
            params.add(maxprice);
        }
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        return qr.query(sql,new BeanListHandler<Book>(Book.class),params.toArray());

    }

    public int count() throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        long l = (Long) qr.query("select count(*) from book", new ScalarHandler(1));
        return (int)l;
    }

    public List<Book> findBooksByPage(int currentPage, int pageSize) throws SQLException {
        QueryRunner qr=new QueryRunner(C3P0Util.getDataSource("day14"));
        return qr.query("select * from book limit ?,?",new BeanListHandler<Book>(Book.class),(currentPage-1)*pageSize,pageSize);
    }
}
```
###### BookListServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    req.setCharacterEncoding("utf-8");
    resp.setContentType("text/html;charset=utf-8");
    BookServiceImpl service=new BookServiceImpl();
    List<Book> list = service.findAllBooks();
    if(list!=null){
        req.setAttribute("books",list);
        req.getRequestDispatcher(req.getContextPath()+"/admin/products/list.jsp").forward(req,resp);
    }
}
```
##### FindBookByIdServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    String id=req.getParameter("id");
    BookServiceImpl service=new BookServiceImpl();
    Book book=service.findBookById(id);
    req.setAttribute("book",book);
    req.getRequestDispatcher("/admin/products/edit.jsp").forward(req,resp);
}
```
##### AddBookServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    req.setCharacterEncoding("utf-8");
    resp.setContentType("text/html;charset=utf-8");
    Book book=new Book();
    try {
        BeanUtils.populate(book,req.getParameterMap());
        book.setId(UUIDUtil.getUUID());
    } catch (Exception e) {
        e.printStackTrace();
    }
    BookServiceImpl service=new BookServiceImpl();
    service.addBook(book);
    req.getRequestDispatcher("bookListServlet").forward(req,resp);//不写/代表相对路径
}
```
##### UpdateBookServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    req.setCharacterEncoding("utf-8");
    resp.setContentType("text/html;charset=utf-8");
    Book book=new Book();
    try {
        BeanUtils.populate(book,req.getParameterMap());
    } catch (Exception e) {
        e.printStackTrace();
    }
    BookServiceImpl service=new BookServiceImpl();
    service.updateBook(book);
    req.getRequestDispatcher("bookListServlet").forward(req,resp);
}
```
##### DelBookServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    String id=req.getParameter("id");
    BookServiceImpl service=new BookServiceImpl();
    service.delBookById(id);
    req.getRequestDispatcher("/servlet/bookListServlet").forward(req,resp);
}
```
###### DelAllBooksServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    String[] ids = req.getParameterValues("ids");
    BookServiceImpl service=new BookServiceImpl();
    service.delAllBooks(ids);
    req.getRequestDispatcher("bookListServlet").forward(req,resp);
}
```
###### SearchBooksServlet
````
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    req.setCharacterEncoding("utf-8");
    String id = req.getParameter("id");
    String category = req.getParameter("category");
    String name = req.getParameter("name");
    String minprice = req.getParameter("minprice");
    String maxprice = req.getParameter("maxprice");
    BookServiceImpl service=new BookServiceImpl();
    List<Book> books=service.searchBooks(id,category,name,minprice,maxprice);
    req.setAttribute("books",books);
    req.getRequestDispatcher("/admin/products/list.jsp").forward(req,resp);
}
```
###### product_list.jsp
```
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>


   <title>bookStore列表</title>
   <%--导入css --%>
   <link rel="stylesheet" href="${pageContext.request.contextPath}/css/main.css" type="text/css" />
</head>

<body class="main">

<jsp:include page="head.jsp" />
<jsp:include page="menu_search.jsp" />

<div id="divpagecontent">
   <table width="100%" border="0" cellspacing="0">
      <tr>

         <td>
            <div style="text-align:right; margin:5px 10px 5px 0px">
               <a href="index.jsp">首页</a>&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp;计算机&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp;图书列表
            </div>

            <table cellspacing="0" class="listcontent">
               <tr>
                  <td>
                     <h1>商品目录</h1>
                     <hr />
                     <h1>计算机</h1>&nbsp;&nbsp;&nbsp;&nbsp;共${pb.count}种商品
                     <hr />
                     <div style="margin-top:20px; margin-bottom:5px">
                        <img src="${pageContext.request.contextPath}/images/productlist.gif" width="100%" height="38" />
                     </div>
                     <table cellspacing="0" class="booklist">
                        <tr>
                           <c:forEach items="${pb.books}" var="b">
                           <td>

                              <div class="divbookpic">
                                 <p>
                                    <a href="${pageContext.request.contextPath}/servlet/bookInfoServlet?id=${b.id}"><img src="" style="background-color: #f1f1f1" width="115" height="129"
                                                 border="0" /> </a>
                                 </p>
                              </div>

                              <div class="divlisttitle">
                                 <a href="#">书名:${b.name}<br />售价:${b.price} </a>
                              </div></td>
                           </c:forEach>
                        </tr>
                     </table>
                     <div class="pagination">
                        <ul>


                           <li class="disablepage">
                              <a href="${pageContext.request.contextPath}/servlet/pageServlet?currentPage=${pb.currentPage==1?1:pb.currentPage-1}">&lt;&lt;上一页</a>
                           </li>


                           <li>第${pb.currentPage}页/共${pb.totalPage}页</li>

                           <li class="nextPage"><a href="${pageContext.request.contextPath}/servlet/pageServlet?currentPage=${pb.currentPage==pb.totalPage?pb.totalPage:pb.currentPage+1}">&lt;&lt;下一页</a></li>


                        </ul>
                     </div></td>
               </tr>
            </table>
         </td>
      </tr>
   </table>
</div>



<jsp:include page="foot.jsp" />


</body>
</html>
```
###### product_info.jsp
```
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%
   String path=request.getContextPath();
   String basPath=request.getScheme()+"://"+request.getServerName()+":"+request.getLocalPort()+path;
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>电子书城</title>
<link rel="stylesheet" href="/css/main.css" type="text/css" />
</head>

<body class="main">

   <jsp:include page="head.jsp" />

   <jsp:include page="menu_search.jsp" />


   <div id="divpagecontent">
      <table width="100%" border="0" cellspacing="0">
         <tr>

            <td><div style="text-align:right; margin:5px 10px 5px 0px">
                  <a href="#">首页</a>&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;<a
                     href="#">&nbsp;计算机</a>&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp;java编程思想
               </div>





               <table cellspacing="0" class="infocontent">
                  <tr>
                     <td><img src="/ad/page_ad.jpg" width="645" height="84" />

                        <table width="100%%" border="0" cellspacing="0">
                           <tr>
                              <td width="30%">

                                 <div class="divbookcover">
                                    <p>
                                       <img src="#" width="213" height="269" border="0" />
                                    </p>
                                 </div>

                                 <div style="text-align:center; margin-top:25px">
                                    <a href="#"> <img src="/images/buybutton.gif" border="0" />
                                    </a>
                                 </div>
                              </td>
                              <td style="padding:20px 5px 5px 5px"><img
                                 src="/images/miniicon3.gif" width="16" height="13" /><font
                                 class="bookname">&nbsp;&nbsp;${b.name}</font>

                                 <hr />售价：<font color="#FF0000">￥:${b.price}元</font>
                                 <hr /> 类别：${b.category}

                                 <hr />
                                 <p>
                                    <b>内容简介：</b>
                                 </p>${b.description}</td>
                           </tr>
                        </table>
                     </td>
                  </tr>
               </table></td>
         </tr>
      </table>
   </div>


   <jsp:include page="foot.jsp" />


</body>
</html>
```
###### PageServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    int pageSize=4;
    int currentPage=1;
    String currpage=req.getParameter("currentPage");
    if(currpage!=null){
        currentPage=Integer.parseInt(currpage);
    }
    BookServiceImpl service=new BookServiceImpl();
    PageBean pb=service.findBooksPage(currentPage,pageSize);
    req.setAttribute("pb",pb);
    req.getRequestDispatcher("/product_list.jsp").forward(req,resp);
}
```
###### BookInfoServlet
```
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    String id = req.getParameter("id");
    BookServiceImpl service=new BookServiceImpl();
    Book book = service.findBookById(id);
    req.setAttribute("b",book);
    req.getRequestDispatcher("/product_info.jsp").forward(req,resp);
}
```
