---
---
layout: post
title: mysql02
tags:
- java

categories: java
description: mysql02
---
## 数据完整性
>保证用户输入的数据保存到数据库中是正确的
在创建表时给表中添加约束
## 主键约束(Primary key)
>数据唯一，且不能为null
```sql
//第一种方式
create table 表名(字段 字段类型 primary key,字段n 类型);
//第二中方式 联合主键
create table 表名(字段1 字段类型,字段2 类型，字段n 类型，primary key(字段1，字段2));
//第三种方式
altet table 表名 add constraint 约束名称 primary key(字段1，字段2);
```
## 唯一约束(unique)
>不能重复
```sql
create table 表名(字段1 类型 unique,字段n 类型)；
```
## 自动增长(auto_increment)
>删除后还会增长
```sql
create table 表名(字段1 类型 auto_increment
```
## 域完整性
>域代表当前单元格 域完整约束：数据类型 非空约束(not null) 默认值约束（default) check约束(mysql 不支持) check(sex='男' or sex='女')
## 非空约束(not null)
```sql
create table 表名(字段1 类型 not null,字段n 类型);
```
## 默认值约束
>insert into 表名 name(字段1，字段n) values(defalult,值n);
```sql
create table 表名(字段1 类型 default '默认值',字段n 类型);
```
## 引用完整性

## 外键约束(foreign key)
>关联的必须是主键
```sql
//方式一
create table 表名(字段1 类型,字段n 类型, constraint 约束名称 foreign key(字段1) refereces 表名(字段名));  
//方式二
alter table 表名 add constraint 约束名称 foreign key(字段名称) references 表名(字段名));   
```
## 表与表之间的关系
* 一对多(多对一)
>外键约束
* 多对多
>第三个表分别和前2个表有外键约束
* 一对一
>子表 添加主键约束或者添加unique

## 多表查询
### 合并结果集
> union union all
字段名可以不同 类型必须相同
```sql
select * from 表名1
union
select * from 表名2；

select 相同类型的字段名1，字段名2 from 表名1
union all
select 字段名 from 表名2;
```
### 链接查询

#### 内连接 [inner] join on
```sql
select * from 表名1,表名2
where 表名1.字段名1 =表名2.字段名2；
```
```sql
select 别名1.字段n,别名2.字段n from 表名1 别名1
join 表名2 别名2 on 别名1.字段名=别名2.字段名
where ...
```
#### 外链接 outer join on
##### 左外链接 left [outer] join on
```sql
select 别名1.字段n,别名2.字段n from 表名1 别名1 left join 表名2 别名2
on 别名1.字段=别名2.字段
```
##### 右外链接 right [outer] join on
```sql
select 别名1.字段n,别名2.字段n from 表名1 别名1 right join 表名2 别名2
on 别名1.字段=别名2.字段
```
##### 多表查询
```sql
select 别名1.字段n,别名2.字段n,别名3.字段n
from 表名1 别名1 ，表名2 别名2 ，表名3 别名3
where 别名1.字段名=别名2.字段名
and 别名2.字段名=别名3.字段名
```
```sql
select 别名1.字段n,别名2.字段n,别名3.字段n
from 表名1 别名1
join 表名2 别名2
on 别名1.字段名=别名2.字段名
join 表名3 别名3
on 别名2.字段名=别名3.字段名
```
##### 全外链接（mysql不支持）full join
#### 自然链接natural join
>自动查找名称和类型完全一致的列作为条件
```sql
select * from 表名1
natural join 表名2；

select * from 表名1
natural left join 表名2；

select * from 表名1
natural rightjoin 表名2；

```
### 子查询
>子查询就是嵌套查询,即select 中包含select,如果一条语句包含2个或2个以上select 就是子查询
>子查询出现的位置 where后作为条件的一部分(还可以使用any all关键字) from后 做表
```sql
select * from 表名 where 字段名=
(select 字段名 from 表名 where...)

//大于最大值
select * from 表名 where 字段名>
all(select 字段名 from 表名 where..)

//大于任意值
select * from 表名 where 字段名>
any(select 字段名 from 表名 where..)

//查询多个字段都相等的
select * from 表名 where (字段1，字段n）in
(select 字段1，字段n from 表名 where ...)

```

#### 自链接
>自己链接自己
```sql
select 别名1.字段，别名2.字段...
from 表名1 别名1，表名1 别名2
where 别名1.字段x=别名2.字段y
```
## 函数
#### 日期函数
|方法|备注|示例|
|-----|-----|-----|
|addtime(date2,time_interval)|将time_interval加到date2| select addtime('13:02:01','01:02:33')|
|current_date()|当前日期|select current_date()|
|current_tiem()|当前时间|select current_time()|
|current_timestamp()|当前时间戳|select current_timestamp()|
|date(datetime)|返回datetiem日期部分|select date(now())|
|date_add(date2,interval d_value d_type)|在date2中加上日期或时间|select date(now(),interval 1 day)|
|date_sub(date2,interval d_value d_type)|在date2中减去一个时间|
|datediff(date1,date2)|2个日期差|
|now()|当前时间|
|year(datetiem) month(datetiem) day(datetiem)|年月日|
#### 字符串函数
|方法|备注|示例|
|-----|-----|------|
|charset(str)|返回字符串字符集|select charset(str) //utf-8|
|concat(string2 [....])|链接字符串|select concat('aa','bb','cc')|
|instr(string,substring)|返回substring在string中出现的位置，没有返回0|select instr('abcc','cc')|
|ucase(string2)|转化成大写|
|lcase(string2)|转化成小写|
|left(string,length)|从string2中的左边去取length个字符|select left('abcdef',3)|
|length(string)|string的长度|
|replace(str,search_str,replace_str|在str中用replce_str替换search_str|select replace('abc','bc','sql')
|strcmp(string1,string2)|逐字符比较字符串大小|select strcmp('abcdef','abcefg')|
|substring(str,position [,length]|从str的position开始,取length个字符|select substring('abcedf',2,2)|
|lirim(string2) ririm(string) trim|去除前段空格和后端空格|

#### 数据相关函数
|方法|备注|示例|
|-----|-----|------|
|abs(num)|绝对值|select abs(-11)|
|bin(num)|十进制转二进制|select bin(2)|
|ceiling(num)|向上取整|select ceiling(12.3)|
|conv(num,from_base,to_base)|进制转换|
|floor(num)|向下取整|select floor(12.6)
|format(num,decimal_paces)|保留小数位|select format(12.335,2)会四舍五入|
|hex(num)|转十六进制|
|least(num,num2....)|求最小值|select least(1,3,-1,2)|
|mod(num1,num2)|求余|
|rand([seed])|随机|

## 数据库备份和恢复
#### 生成sql脚本
>mysqldump -u 用户名 -p 数据库名 >生成脚本路径
只会导出数据，不会存在创建数据库语句

```sql
mysqldump -u root -p mydb1>'/zhxiaol/aaa/mydb1.sql'
```
#### 恢复数据
> source 路径 :登陆mysql,进入指定数据库，执行sql脚本 路径不能写引号
> mysql -u 用户名 -p 数据库<要执行脚本路径
```sql
source /zhxiaol/aaa/mydb1.sql;

mysql -u root -p mydb1<'/zhxiaol/aaa/mydb1.sql';
```



## 练习
```sql
//查询有2个以上下属的员工
//查询编号7788信息+部门地址
//求7369员工编号，姓名，经理编号和经理姓名
//求各个部门薪水最高的员工所有信息

```
