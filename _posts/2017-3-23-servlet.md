---
layout: post
title: servlet
tags:
- java

categories: java
description: servlet
---
## Servlet
> servlet 是运行在web服务器的小型java程序。servlet通常通过HTTP接受和响应来自web客户端的请求

1.创建一个实现servlet的实列
```javascript
public class ServletDemo1 implements Servlet{}
```
2.配置web.xml
```xml
<!--创建一个servlet实列-->
<servlet>
    <servlet-name>ServletDemo1</servlet-name>
    <servlet-class>com.itheima.servlet.ServletDemo1</servlet-class>
    <!--服务器启动时就创建-->
    <load-on-startup>1</load-on-startup>
</servlet>
<!--给servlet提供(映射)一个可供客户端访问的URI-->
<servlet-mapping>
    <servlet-name>ServletDemo1</servlet-name>
    <url-pattern>/demo1</url-pattern>
</servlet-mapping>
```
## servlet运行过程
```sequence
客户端-> tomcat:1.http://localhost:8080/ demo
tomcat--> web.xml:2.找到默认项目下的<url-pattern>/demo1
web.xml--> tomcat:3.返回对应的<servlet-class>ServletDemo1
tomcat--> servletDemo1:4.创建ServletDemo1实列
tomcat--> servletDemo1:5.调用init()方法
tomcat--> servletDemo1:6.调用service()方法
servletDemo1-->客户端:7.将信息响应给客户端
tomcat--> servletDemo1:8.调用distory()方法
```
## servlet 生命周期
> 实例化 --> 初始化 --> 服务 --> 销毁
出生:（实列化--初始化）第一次访问就出生了（默认情况）
活着: (服务)应用活着，servlet就活着
死亡: (销毁)应用卸载了 servlet就销毁

## GenericServlet(适配器模式)
```java
public class ServletDemo2 extends GenericServlet {
    @Override
    public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException {
            System.out.println("service");
    }
}
```
## HttpServlet(模板方法设计模式)
```java
public class ServletDemo3 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("******doGet*********");
        System.out.println(req.getRemoteAddr());
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("******doPost*********");
    }
}
```
## servlet的一些细节
> 一个servlet可以对应多个映射
> 优先级 绝对匹配-->/开头匹配-->扩展名匹配
> 如果url-pattern的值是/,表示执行的默认映射。所有资源都是servlet
```xml
<servlet-mapping>
    <servlet-name>ServletDemo4</servlet-name>
    <url-pattern>/abc/*</url-pattern>
</servlet-mapping>
<servlet-mapping>
    <servlet-name>ServletDemo4</servlet-name>
    <url-pattern>/*</url-pattern>
</servlet-mapping>
<servlet-mapping>
    <servlet-name>ServletDemo4</servlet-name>
    <url-pattern>/abc</url-pattern>
</servlet-mapping>
<servlet-mapping>
    <servlet-name>ServletDemo4</servlet-name>
    <url-pattern>*.do</url-pattern>
</servlet-mapping>
```
## Servlet的线程安全
> 解决线程安全的问题的最佳方法，不要写全局变量，写局部变量
## ServletConfig
> 获取配置文件的信息，获取servletContext对象
```javascript
@Override
public void init(ServletConfig config) throws ServletException {
    super.init(config);
    this.config=config;
}

@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    String e1 = config.getInitParameter("encoding");
    String e2 = getServletConfig().getInitParameter("encoding");
    String e3 = this.getInitParameter("encoding");
    System.out.println(e1);
    System.out.println(e2);
    System.out.println(e3);
}
// web.xml
<servlet>
    <servlet-name>ServletDemo5</servlet-name>
    <servlet-class>com.itheima.servlet.ServletDemo5</servlet-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>utf-8</param-value>
    </init-param>
</servlet>
```
## ServletContext
> 代表整个应用，一个应用只有一个servletContext对象，单实例.
> 域对象:在一定范围内(当前应用),使多个Servlet共享数据。

|常用方法|备注|
|------|-----|
|void setAttribute(String name,Object value)|向ServletContext对象map中添加数据
|Object getAttribute(String name)|从ServletContext对象的map中取数据|
|void removeAttibute(String name)|根据name移出数据|
###### 共享数据
```java
//ServletDemo6
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    ServletContext application = this.getServletContext();
    application.setAttribute("name","tom");
    System.out.println("存储name=tom");
}
//ServletDemo7
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    ServletContext application = this.getServletContext();
    String name = (String) application.getAttribute("name");
    System.out.println("name:"+name);
}
```
###### 获取全局配置信息
```javascript
//ServletDemo7
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    ServletContext application = this.getServletContext();
    String e = application.getInitParameter("encoding");
    System.out.println("encoding:"+e);
}
//web.xml
<context-param>
    <param-name>encoding</param-name>
    <param-value>utf-8</param-value>
</context-param>
```
###### 获取资源路径
String getRealPath(String path);//根据资源名称得到资源的绝对路径
> 可以得到当前应用任何位置的任何资源
```javascript
//在WEB-INF/a.properties
String path = this.getServletContext().getRealPath("/WEB-INF/a.properties");
Properties properties = new Properties();
properties.load(new FileInputStream(path));
String value = properties.getProperty("key");
System.out.println(value);

//在src/b.properties
String path = this.getServletContext().getRealPath("/WEB-INF/classes/b.properties");
Properties properties=new Properties();
properties.load(new FileInputStream(path));
String value = properties.getProperty("key");
System.out.println(value);

//在src/com.itheima.servlet/c.properties
String path = this.getServletContext().getRealPath("/WEB-INF/classess/com/itheima/servlet/c.properties");
Properties properties = new Properties();
properties.load(new FileInputStream(path));
String key = properties.getProperty("key");
System.out.println(key);
```

## Servlet转发
> 一次请求响应
```javascript
//ServletDemo9
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    System.out.println("我要办事");
    System.out.println("你的事我办不了，我可以帮你找人办");
    ServletContext application = this.getServletContext();
    RequestDispatcher rd = application.getRequestDispatcher("/demo10");
    rd.forward(req,resp);
    System.out.println("事办完了");
}
//ServletDemo10
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    System.out.println("这个事我能办");
}
//web.xml
<servlet>
    <servlet-name>ServletDemo9</servlet-name>
    <servlet-class>com.itheima.servlet.ServletDemo9</servlet-class>
</servlet>
<servlet-mapping>
    <servlet-name>ServletDemo9</servlet-name>
    <url-pattern>/demo9</url-pattern>
</servlet-mapping>
<servlet>
    <servlet-name>ServletDemo10</servlet-name>
    <servlet-class>com.itheima.servlet.ServletDemo10</servlet-class>
</servlet>
<servlet-mapping>
    <servlet-name>ServletDemo10</servlet-name>
    <url-pattern>/demo10</url-pattern>
</servlet-mapping>
```
