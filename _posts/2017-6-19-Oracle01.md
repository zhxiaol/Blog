---
layout: post
title: Oracle
tags:
- java

categories: java
description: Oracle
---

###### 查询10号部门的员工
```SQL
select * from emp where deptno=10;
```


###### 字符大小写敏感
###### 查询名叫KING的员工
```SQL
select * from emp where ename='KING';
```

```SQL
 select * from emp where ename='King'
```



###### 日期格式敏感
###### 查询入职日期是17-11月-81的员工

```SQL
select * from emp  where hiredate='17-11月-81';
```



```SQL
select * from emp where hiredate='1981-11-17'
/
where hiredate='1981-11-17'
               *
第 3 行出现错误:
ORA-01861: 文字与格式字符串不匹配

```


###### 修改日期格式
```SQL
select * from v$nls_parameters;
alter session set NLS_DATE_FORMAT='yyyy-mm-dd';
```

## 清屏
host cls

###### between  and
###### 查询薪水1000~2000之间的员工
```sql
select * from emp  where sal between 1000 and 2000;
```


###### between  and: 1. 含有边界  2. 小值在前 大值在后


###### in 在集合中
###### 查询10和20号部门的员工
```sql
select * from emp  where deptno in (10,20);
```


###### 查询不是10和20号部门的员工
```sql

   select *  from emp  where deptno not in (10,20)
```

###### null 值 3. 如果集合中含有null，不能使用not in; 但可以使用in
```sql

 select * from emp  where deptno not in (10,20,null)
```

```sql
  select * from emp where deptno in (10,20,null)
```
###### like 模糊查询
###### 查询名字以S打头的员工
```sql
select *  from emp  where ename like 'S%';
```

###### 查询名字是4个字的员工
```sql
select *   from emp where ename like '____'
insert into emp(empno,ename,sal,deptno) values(1001,'Tom_AB',3000,10);
```

###### 查询名字中含有下划线的员工
```sql
//查询的是所有
select *  from emp where ename like '%_%';
```

###### 转意字符
```sql
 select * from emp  where ename like '%\_%' escape '\'
```
###### 回滚
```sql
rollback;
```
###### Oracle是自动开启事务
###### SQL 优化 2. where解析顺序： 右--》 左


###### 排序
###### 查询员工信息 按照月薪排序
```sql
select * from emp order by sal;
```


###### order by后面  + 列，表达式，别名，序号
```sql
select empno,ename,sal,sal*12 from emp  order by sal*12 desc;

select empno,ename,sal,sal*12 年薪 from emp order by 年薪 desc

select empno,ename,sal,sal*12 年薪 from emp rder by 4 desc
```

```sql
select empno,ename,sal,sal*12 年薪 rom emp  order by 5 desc
//出现错误 ORA-01785: ORDER BY 项必须是 SELECT-list 表达式的数目

```



###### 多个列排序
```sql
select *  from emp order by deptno,sal;
```


```sql
select *  from emp order by deptno,sal desc
```

```sql

select *  from emp order by deptno desc,sal desc
```


###### order by 作用于后面所有的列；desc只作用于离他最近的列


###### 查询员工信息  按照奖金排序
###### null值  4. null的排序
```
select * from emp order by comm;
set pagesize 20
```


```sql
 select * from emp order by comm desc
```

###### null值最大
```sql

select *  from emp order by comm desc  nulls last
```


###### 清屏
host cls

###### 当前用户
show user
USER 为 "SCOTT"
###### 当前用户下的表
```sql
select * from tab;    
```                                       

###### 员工表的结构
```sql
desc emp
```


###### 查询所有的员工信息
```sql
select * from emp;
```



###### 设置行宽
```sql
show linesize
linesize 80
set linesize 150
```


###### 设置列宽
```sql
col ename for a8
col sal for 9999
```

/*
SQL优化（数据库的优化）
1. 尽量使用列名
*/
###### 查询员工信息： 员工号  姓名 月薪

```sql

select empno,ename,sal
form emp;

//ORA-00923: 未找到要求的 FROM 关键字
```


###### c命令  change
```sql
2
  2* form emp
c /form/from
  2* from emp
/
```



###### 查询员工信息： 员工号  姓名 月薪 年薪
```sql
select empno,ename,sal,sal*12  from emp;
```

###### 查询员工信息： 员工号  姓名 月薪 年薪 奖金 年收入
```sql
select empno,ename,sal,sal*12,comm,sal*12+comm from emp;
```




/*
SQL中的null值:
1. 包含null的表达式都为null
2. null永远!=null
*/

###### 2. null永远!=null
###### 查询奖金为null的员工
```sql
[未选定行]select *  from emp where comm=null;

[正确]select * from emp where comm is null;

```



###### 列的别名
```sql
select empno,ename,sal,sal*12,comm,sal*12+nvl(comm,0)  from emp;
```



```sql
[错误]select empno as "员工号",ename "姓名",sal 月    薪,sal*12,comm,sal*12+nvl(comm,0)
from emp

[正确]select empno as "员工号",ename "姓名",sal "月    薪",sal*12,comm,sal*12+nvl(comm,0)
from emp
````



###### distinct去掉重复记录
```sql
select deptno from emp;

select distinct deptno from emp;

select job from emp;

select distinct job from emp;

select distinct deptno, job from emp;
```


###### distinct作用于后面所有的列


###### 连接符
######  concat
```sql
//未找到要求的 FROM 关键字
[错误]select concat('Hello','  World');

[错误]select concat('Hello','  World')

[正确]select concat('Hello','  World') from emp;

[正确]select concat('Hello','  World') from dual;
```

###### dual 表：伪表
(伪列)
/
(伪列)
 *
第 1 行出现错误:
ORA-00928: 缺失 SELECT 关键字

```sql
select 'Hello'||'  World' 字符串 from dual;
```



###### 查询员工信息： ***的薪水是****
```sql
select ename||'的薪水是'||sal 信息 from emp;
```



###### 字符串
```sql
select * from emp;
```


###### 字符函数

```sql  select lower('Hello World') 转小写,upper('Hello World') 转大写,initcap('hello world') 首字母大写
from dual;



###### substr(a,b) 从a中，第b位开始取
```sql  
select substr('Hello World',3) 子串 from dual;
```


###### substr(a,b,c) 从a中，第b位开始取,取c位
```sql  
select substr('Hello World',3,4) 子串 from dual;
```                                                                           

###### instr(a,b)
```sql
 select instr('Hello World','ll') 位置 from dual;
 ```



###### length 字符数 lengthb 字节数
```sql  
select length('Hello World') 字符,lengthb('Hello World') 字节 from dual;
```



```sql
select length('北京') 字符,lengthb('北京') 字节 from dual
```




###### lpad 左填充  rpad 右填充
######  abcd ---> 10 位
```sql  
select lpad('abcd',10,'*') 左,rpad('abcd',10,'*') 右 from dual;
```



###### trim 去掉前后指定的字符
```sql  
select trim('H' from 'Hello WorldH') from dual;
```



###### replace
```sql  
select replace('Hello World','l','*') from dual;
```



###### 四舍五入
```sql  
select round(45.926,2) 一,round(45.926,1) 二,round(45.926,0) 三,
       round(45.926,-1) 四,round(45.926,-2) 五
from dual;

        一         二         三         四         五                          
---------- ---------- ---------- ---------- ----------                          
     45.93       45.9         46         50          0     
```



###### 截断
```sql  
select trunc(45.926,2) 一,trunc(45.926,1) 二,trunc(45.926,0) 三,
       trunc(45.926,-1) 四,trunc(45.926,-2) 五
from dual
```sql  /



###### 查询当前时间
```sql  
select sysdate  from dual;

--------------                                                                  
22-11月-15     
```



###### to_char
```sql  
select to_char(sysdate,'yyyy-mm-dd hh24:mi:ss')  from dual;
-------------------                                                             
2015-11-22 15:05:22   
```




###### 昨天 今天 明天
```sql  
select (sysdate-1) 昨天,sysdate 今天,(sysdate+1) 明天 from dual;
```



###### 计算员工的工龄：天  星期  月 年
```sql  
select ename,hiredate, (sysdate-hiredate) 天,(sysdate-hiredate)/7 星期,
(sysdate-hiredate)/30 月,(sysdate-hiredate)/365 年
from emp;
```


###### 不允许日期 + 日期
```sql

select sysdate + hiredate from emp;

select sysdate + hiredate from emp

```

###### months_between
```sql
select ename,hiredate,(sysdate-hiredate)/30 一,months_between(sysdate,hiredate) 二
from emp;
```


###### 56 个月后
```sql  
select add_months(sysdate,56) from dual;
```


```sql  
select last_day(sysdate) from dual;
```



###### next_day
###### 下一个星期日
```sql  
select next_day(sysdate,'星期日') from dual;
```



###### 下一个星期一
```sql  
select next_day(sysdate,'星期一') from dual;
```




```sql  
select round(sysdate,'month'),round(sysdate,'year') from dual;
```


###### 2015-11-22 15:32:12今天是星期日
```sql  
//日期格式无法识别
[错误]select to_char(sysdate,'yyyy-mm-dd hh24:mi:ss今天是day') from dual;

[错误]select to_char(sysdate,'yyyy-mm-dd hh24:mi:ss今天是day') from dual

[正确]select to_char(sysdate,'yyyy-mm-dd hh24:mi:ss"今天是"day') from dual;
```



###### 查询员工薪水：两位小数 千位符 货币代码
```sql  
select to_char(sal,'L9,999.99') from emp;
-------------------                                                             
           ￥800.00                                                             
         ￥1,600.00  
```

###### nvl2(a,b,c) 当a=null的时候，返回c；否则返回b
```sql  
select sal*12+nvl2(comm,comm,0) from emp;
````




###### nullif(a,b) 当a=b的时候，返回null；否则返回a
```sql  
select nullif('abc','abc') 值 from dual;
```


```sql  
select nullif('abc','abcd') 值 from dual;

---                                                                             
abc
```



###### coalesce 从左到右找到第一个不为null的值
```sql  
select comm,sal,coalesce(comm,sal) "第一个不为null的值"
from emp;
```


```sql  host cls

###### 涨工资，总裁1000 经理 800 其他400
```sql  
set linesize 200
select * from emp;
```


```sql  
select ename,job,sal 涨前,
case job when 'PRESIDENT' then sal+1000
when 'MANAGER' then sal+800
else sal+400
end 涨后
from emp;
```



```sql
select ename,job,sal 涨前,
decode(job,'PRESIDENT',sal+1000,
'MANAGER',sal+800,
sal+400) 涨后
from emp;
```



###### 工资总额
```sql  
select sum(sal) from emp;
```

###### 人数
```sql  
select count(*) from emp;
```



###### 平均工资
```sql
 select sum(sal)/count(*) 一,avg(sal) 二  from emp;
```



###### 平均奖金
```sql  
select sum(comm)/count(*) 一,sum(comm)/count(comm) 二,avg(comm) 三
from emp;
```


```sql  
select count(*),count(comm) from emp;
```



```sql  
select * from emp;
```



###### null值 5.组函数（多行函数）自动滤空
```sql  
select count(*),count(nvl(comm,0)) from emp;
```



###### null值 5.组函数（多行函数）自动滤空;可以嵌套滤空函数 来屏蔽他的滤空功能

###### 求每个部门的平均工资
```sql  select deptno,avg(sal)
from emp
group by deptno;
```



###### 多个列的分组
```sql  
select deptno,job,sum(sal)
from emp
group by deptno,job
order by 1;
```


###### 求平均工资大于2000的部门
```sql  
select deptno,avg(sal)
from emp
group by deptno
having avg(sal) > 2000;
```



###### where和having的区别：where后面不能使用多行函数
###### 查询10号部门的平均工资
```sql  
select deptno,avg(sal)
from emp
group by deptno
having deptno=10;
```



```sql
select deptno,avg(sal)
from emp
where deptno=10
group by deptno
```                                                                                                                                                                               

###### SQL 优化原则3. 尽量使用where

###### group by的增强
```sql
break on deptno skip 2
select deptno,job,sum(sal) from emp group by rollup(deptno,job);
```


```sql  
break on null
```

###### 等值连接
###### 查询员工信息： 员工号 姓名 月薪 部门名称
```
set linesize 80
desc dept
```


```sql  
select e.empno,e.ename,e.sal,d.dname
from emp e,dept d
where e.deptno=d.deptno;
```

###### 不等值连接
###### 查询员工信息： 员工号 姓名 月薪 工资级别

```sql  
select e.empno,e.ename,e.sal,s.grade
from emp e,salgrade s
where e.sal between s.losal and s.hisal;
```



###### 外连接
###### 按部门统计员工人数：部门号 部门名称 人数
```sql  
select d.deptno 部门号,d.dname 部门名称,count(e.empno) 人数
from emp e,dept d
where e.deptno=d.deptno
group by d.deptno,d.dname;
```

```
希望： 对于某些不成立的记录，任然希望包含在最后的结果中
左外连接：当where e.deptno=d.deptno不成立的时候，等号左边的表任然被包含
写法:where e.deptno=d.deptno(+)
右外连接：当where e.deptno=d.deptno不成立的时候，等号右边的表任然被包含
写法: where e.deptno(+)=d.deptno
```


```sql  
select d.deptno 部门号,d.dname 部门名称,count(e.empno) 人数
from emp e,dept d
where e.deptno(+)=d.deptno
group by d.deptno,d.dname;
```



###### 自连接
###### 查询员工信息：员工姓名 老板姓名
```
set linesize 200
select * from emp;
```


###### 自连接： 通过表的别名，将同一张表视为多张表
```sql  
select e.ename 员工姓名,b.ename 老板姓名
from emp e,emp b
where e.mgr=b.empno;
```


```sql  
select count(*)
from emp e, emp b;
```


###### 自连接不适合操作大表
###### 层次查询
```sql  
select level,empno,ename,mgr
from emp
connect by prior empno=mgr
start with mgr is null
order by 1;
```
