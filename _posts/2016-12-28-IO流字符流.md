---
layout: post
title: IO流字符流
tags:
- life

categories: life
description:
---
## 字符流
 字符流是可以直接读写字符的IO流
 字符流读取字符, 就要先读取到字节数据, 然后转为字符. 如果要写出字符, 需要把字符转为字节再写出.    
###### FileReader类的read()方法可以按照字符大小读取
```java
		FileReader fr = new FileReader("aaa.txt");				
		int ch;
		while((ch = fr.read()) != -1) {							
			System.out.println((char)ch);						
		}		
		fr.close();											
```

###### FileWriter类的write()方法可以自动把字符转为字节写出
```java
		FileWriter fw = new FileWriter("aaa.txt");
		fw.write("aaa");
		fw.close();
```


### 字符流注意事项
字符流也可以拷贝文本文件, 但不推荐使用. 因为读取时会把字节转为字符, 写出时还要把字符转回字节.
不可以拷贝非纯文本的文件
因为在读的时候会将字节转换为字符,在转换过程中,可能找不到对应的字符,就会用?代替,写出的时候会将字符转换成字节写出去


### 自定义字符数组的拷贝
```java
		FileReader fr = new FileReader("aaa.txt");			
		FileWriter fw = new FileWriter("bbb.txt");			

		int len;
		char[] arr = new char[1024*8];						
		while((len = fr.read(arr)) != -1) {					
			fw.write(arr, 0, len);							
		}
		fr.close();										
		fw.close();
```

### 带缓冲的字符流
BufferedReader的read()方法读取字符时会一次读取若干字符到缓冲区, 然后逐个返回给程序, 降低读取文件的次数, 提高效率
BufferedWriter的write()方法写出字符时会先写到缓冲区, 缓冲区写满时才会写到文件, 降低写文件的次数, 提高效率
```java
		BufferedReader br = new BufferedReader(new FileReader("aaa.txt"));
		BufferedWriter bw = new BufferedWriter(new FileWriter("bbb.txt"));
		int ch;				
		while((ch = br.read()) != -1) {		//read一次,会先将缓冲区读满,从缓冲去中一个一个的返给临时变量c
			bw.write(ch);				//write一次,是将数据装到字符数组,装满后再一起写出去
		}
		br.close();							
		bw.close();  
```

### readLine()和newLine()方法)
BufferedReader的readLine()方法可以读取一行字符(不包含换行符号)
BufferedWriter的newLine()可以输出一个跨平台的换行符号"\r\n"
```java
		BufferedReader br = new BufferedReader(new FileReader("aaa.txt"));
		BufferedWriter bw = new BufferedWriter(new FileWriter("bbb.txt"));
		String line;
		while((line = br.readLine()) != null) {
			bw.write(line);
			//bw.write("\r\n");				
			bw.newLine();						//跨平台的
		}
		br.close();
		bw.close();
```

### LineNumberReader
 LineNumberReader是BufferedReader的子类, 具有相同的功能, 并且可以统计行号
调用getLineNumber()方法可以获取当前行号
调用setLineNumber()方法可以设置当前行号

```java
		LineNumberReader lnr = new LineNumberReader(new FileReader("aaa.txt"));
		String line;
		lnr.setLineNumber(100);									//设置行号
		while((line = lnr.readLine()) != null) {
			System.out.println(lnr.getLineNumber() + ":" + line);//获取行号
		}
		lnr.close();
```

### 装饰设计模式
###### IO流的嵌套就是装饰设计模式
```java
		interface Coder {
			public void code();
		}
		class Student implements Coder {
			@Override
			public void code() {
				System.out.println("javase");
				System.out.println("javaweb");
			}
		}
		class HeiMaStudent implements Coder {
			private Student s;					 //获取到被包装的类的引用
			public ItcastStudent(Student s) {		//通过构造函数创建对象的时候,传入被包装的对象
				this.s = s;
			}
			@Override
			public void code() {					//对其原有功能进行升级
				s.code();
				System.out.println("数据库");
				System.out.println("ssh");
				System.out.println("安卓");
				System.out.println(".....");
			}
		}
```

##  InputStreamReader和OutputStreamWriter
###### 字节流和字符流转换的桥梁
```java
		BufferedReader br = 									
				new BufferedReader(new InputStreamReader(new FileInputStream("UTF-8.txt"), "UTF-8"));
		BufferedWriter bw = 					
				new BufferedWriter(new OutputStreamWriter(new FileOutputStream("GBK.txt"), "GBK"));
		int ch;
		while((ch = br.read()) != -1) {
			bw.write(ch);
		}
		br.close();
		bw.close();
```


## 练习
###### 获取一个文本上每个字符出现的次数,将结果写在times.txt上
```java
BufferedReader br=new BufferedReader(new FileReader("xxx.txt"));
TreeMap<Character,Integer>tm=new TreeMap<>();
int ch;
while((ch=br.read())!=-1){
    char c=(char)ch;
    tm.put(c,tm.containsKey(c)?tm.get(c)+1:1);
}
br.close();
BufferedWriter bw=new BufferedWriter(new FileWriter("times.txt"));
Set<Map.Entry<Character, Integer>> entrySet = tm.entrySet();
for(Map.Entry<Character,Integer> entry:entrySet){
    bw.write(entry.getKey()+":"+entry.getValue());
    bw.newLine();
}
bw.close();
```
###### 10次试用机会
```java
BufferedReader br=new BufferedReader(new FileReader("config.txt"));
String line=br.readLine();
int times = Integer.parseInt(line);
br.close();
if(times>0){
    System.out.println("您还有"+times-- +"次机会");
    FileWriter fw=new FileWriter("config.txt");
    fw.write(String.valueOf(times));
    fw.close();
}else {
    System.out.println("您的试用次数已到，请购买正版软件");
}
```
###### 5的阶乘
```java
public static int factorial(int num){
    if(num==1)return num;
    return num*factorial(num-1);
}
public static int factorial2(int num){
    int result=num;
    while(num>1){
        result=result*(num-- -1);
    }
    return result;
}
```
